<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="Bookmark" th:href="@{/static/favicon.ico}" >
	<link rel="Shortcut Icon" th:href="@{/static/favicon.ico}" />
	<!--[if lt IE 9]>
	<script type="text/javascript" th:src="@{lib/html5shiv.js}"></script>
	<script type="text/javascript" th:src="@{lib/respond.min.js}"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" th:href="@{static/h-ui/css/H-ui.min.css}" />
	<link rel="stylesheet" type="text/css" th:href="@{static/h-ui.admin/css/H-ui.admin.css}" />
	<link rel="stylesheet" type="text/css" th:href="@{lib/Hui-iconfont/1.0.8/iconfont.css}" />
	<link rel="stylesheet" type="text/css" th:href="@{static/h-ui.admin/skin/default/skin.css}" id="skin" />
	<link rel="stylesheet" type="text/css" th:href="@{static/h-ui.admin/css/style.css}" />
	<!--[if IE 6]>
	<script type="text/javascript" th:src="@{lib/DD_belatedPNG_0.0.8a-min.js}" ></script>
	<script>DD_belatedPNG.fix('*');</script>
	<![endif]-->
	<!--/meta 作为公共模版分离出去-->

	<title>添加计划</title>
	<meta name="keywords" content="H-ui.admin v3.1,H-ui网站后台模版,后台模版下载,后台管理系统模版,HTML后台模版下载">
	<meta name="description" content="H-ui.admin v3.1，是一款由国人开发的轻量级扁平化网站后台模板，完全免费开源的网站后台管理系统模版，适合中小型CMS后台系统。">
</head>
<body>
<article class="page-container">
	<form action="/add_plan" method="post" class="form form-horizontal" id="form-member-add">
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>计划时间：</label>
			<div class="formControls col-xs-8 col-sm-9">
                <input type="text" onfocus="WdatePicker({ planDate:'#F{$dp.$D(\'datemax\')||\'%y-%M-%d\'}' })" id="planDate" name="planDate" class="input-text Wdate">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>计划安排：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<textarea id="planWork" name="planWork" cols="" rows="" class="textarea"  placeholder="计划内容..." onKeyUp="$.Huitextarealength(this,100)"></textarea>
				<!--<p class="textarea-numberbar"><em class="textarea-length">0</em>/100</p>-->
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3">实际进度：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<textarea id="actualWork" name="actualWork" cols="" rows="" class="textarea"  placeholder="实际内容..." onKeyUp="$.Huitextarealength(this,100)"></textarea>
				<!--<p class="textarea-numberbar"><em class="textarea-length">0</em>/100</p>-->
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3">进度记录时间：</label>
			<div class="formControls col-xs-8 col-sm-9">
                <input type="text" onfocus="WdatePicker({ actualWorkDate:'#F{$dp.$D(\'datemax\')||\'%y-%M-%d\'}' })" id="actualWorkDate" name="actualWorkDate" class="input-text Wdate">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3">实际完成时间：</label>
			<div class="formControls col-xs-8 col-sm-9">
                <input type="text" onfocus="WdatePicker({ completeDate:'#F{$dp.$D(\'datemax\')||\'%y-%M-%d\'}' })" id="completeDate" name="completeDate" class="input-text Wdate">
			</div>
        </div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>状态：</label>
			<div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
				<select class="select" size="1" name="complete" id="select">
					<option value="" selected>请选择</option>
					<option value="0">未完成</option>
					<option value="1">已完成</option>
				</select>
				</span> </div>
		</div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>项目名称：</label>
            <div class="formControls col-xs-8 col-sm-9"><span class="select-box">
				<select class="select" size="1" id="select_item_name"  name='itemID'>
					<option value="" selected>请选择</option>
				</select>
            </span></div>
        </div>

        <input id="planId" name="id" value="" type="hidden"/>
		<!--<div class="row cl">-->
			<!--<label class="form-label col-xs-4 col-sm-3">备注：</label>-->
			<!--<div class="formControls col-xs-8 col-sm-9">-->
				<!--<textarea name="beizhu" cols="" rows="" class="textarea"  placeholder="计划内容..." onKeyUp="$.Huitextarealength(this,100)"></textarea>-->
				<!--<p class="textarea-numberbar"><em class="textarea-length">0</em>/100</p>-->
			<!--</div>-->
		<!--</div>-->
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
				<input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
			</div>
		</div>
	</form>
</article>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" th:src="@{lib/jquery/1.9.1/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{lib/layer/2.4/layer.js}"></script>
<script type="text/javascript" th:src="@{static/h-ui/js/H-ui.min.js}"></script>
<script type="text/javascript" th:src="@{static/h-ui.admin/js/H-ui.admin.js}"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" th:src="@{lib/My97DatePicker/4.8/WdatePicker.js}"></script>
<script type="text/javascript" th:src="@{lib/jquery.validation/1.14.0/jquery.validate.js}"></script>
<script type="text/javascript" th:src="@{lib/jquery.validation/1.14.0/validate-methods.js}"></script>
<script type="text/javascript" th:src="@{lib/jquery.validation/1.14.0/messages_zh.js}"></script>
<script type="text/javascript">
    $(function(){
        var id = getQueryString("id");

        /*修改计划*/
        if (id) {
            $.ajax({
                "url": "selectPlanByPlanId",
                "data": {"planId":id},
                "type": "POST",
                "dataType": "json",
                "success": function(obj) {
                    if (obj.state == 1) {
                        var plan = obj.data;
                        $("#planDate").val(FormatDate(plan.planDate));
                        $("#planWork").val(plan.planWork);
                        $("#actualWork").val(plan.actualWork);
                        $("#actualWorkDate").val(FormatDate(plan.actualWorkDate));
                        $("#select").val(plan.complete);
                        $("#completeDate").val(FormatDate(plan.completeDate));
                        $.ajax({
                            "url": "handle_findItemByID",
                            "data": {"id":plan.itemID},
                            "type": "POST",
                            "dataType": "json",
                            "success": function(obj) {
                                if (obj.state==1){
                                    $("#select_item_name  option:selected").text(obj.data.itemName);
                                    $("#select_item_name  option:selected").val(obj.data.id);
                                    $("#select_item_name").attr("disabled","disabled");
								} else{
                                    layer.alert(obj.message);
								}
							}
						});

                    } else {
                        layer.alert(obj.message);
                    }
                }
            });
        }

        /*添加项目列表下拉框内容*/
        $.ajax({
            "url": "handle_item_query",
            "data": {},
            "type": "POST",
            "dataType": "json",
            "success": function(obj) {
                if (obj.state == 1){
                    var item = obj.data;
                    for(var i in item) {        //遍历输出list添加为option
                        $("#select_item_name").append("<option value='" + item[i].id + "'>" + item[i].itemName + "</option>")
                        console.log($("#select_item_name  option:selected").val());
                    }
                } else {
                    $("#select_item_name").append("<option value=''>" + obj.message + "</option>")
                }
            }
        });

        $('.skin-minimal input').iCheck({
            checkboxClass: 'icheckbox-blue',
            radioClass: 'iradio-blue',
            increaseArea: '20%'
        });

        $("#form-member-add").validate({
            rules:{
                planDate:{
                    dateISO:true
                    // minlength:2,
                    // maxlength:16
                },
                planWork:{
                    required:true
                },
                select_item_name:{
                    required:true
                },
                select:{
                    required:true
                }

            },
            onkeyup:false,
            focusCleanup:true,
            success:"valid",
            submitHandler:function(form){
                $("#planId").val(id);
                $("#form-member-add").ajaxSubmit();
                alert("提交成功");
                var index = parent.layer.getFrameIndex(window.name);
                //parent.$('.btn-refresh').click();
                parent.layer.close(index);
                //location.replace(document.referrer);
            }
        });
    });

    //格式化日期
    function FormatDate (strTime) {
        if (!strTime)return "";
        var date = new Date(strTime);
        return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();
    }
    //获取url参数
    function getQueryString(name) {
        var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return unescape(r[2]);
        }
        return null;
    }
</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>